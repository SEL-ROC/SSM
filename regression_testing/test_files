#
#   vim:set tw=0:
#

# On each system type tested
test_dir=$(mktemp -d --tmpdir=/tmp ssm.XXX)
repo_dir=$test_dir/etc/ssm
conf=$repo_dir/testy.conf

echo
echo "Test Dir:  $test_dir"
echo "Repo Dir:  $repo_dir"
echo "Test Conf: $conf"
echo

mkdir -p $repo_dir
rsync -av usr/share/doc/examples/ $repo_dir/
cat usr/share/doc/examples/safe_to_run_example_config_file.conf > $conf

#
# Usage:  
#
#   cmd="your command"
#   run_cmd
#
run_cmd() {
    echo
    echo "<<<<<<<<<<<<<<<<<<<<<<<<< BEGIN >>>>>>>>>>>>>>>>>>>>>>>>>>>>"
    echo CMD: $cmd
    $cmd
#    exit_code=$?
#    if [ $exit_code != 0 ]; then
#        echo
#        echo "FAILED!:  $cmd"
#        echo "With an exit code of $exit_code"
#        echo
#        exit $exit_code
#    fi
    echo "<<<<<<<<<<<<<<<<<<<<<<<<< END >>>>>>>>>>>>>>>>>>>>>>>>>>>>"
    echo RECAP: $cmd
    echo
    echo -n "Hit <Enter> to continue..." ; read x
}

cmd="sudo ssm -c $conf --sync --summary"
run_cmd

cmd="sudo ssm -c $conf --sync --no"
run_cmd

cmd="sudo ssm -c $conf --sync --yes"
run_cmd

test_file=$test_dir/test_file.txt
cmd="sudo ssm -c $conf --add-file $test_file"
run_cmd

echo "Creating the test file" > $test_file
cmd="sudo ssm -c $conf --add-file $test_file"
run_cmd

ln -s $test_file ${test_file}.symlink
cmd="sudo ssm -c $conf --add-file ${test_file}.symlink"
run_cmd

newdir=$test_dir/test_dir/
sudo mkdir -p $newdir
cmd="sudo sudo ssm -c $conf --add-file $newdir"
run_cmd

rm -f $test_file
sudo rm -f $test_file
cmd="sudo ssm -c $conf --sync --only-this-file $test_file --yes"
run_cmd

sudo rm -f ${test_file}.symlink 
cmd="sudo ssm -c $conf --sync --only-files --yes"
run_cmd

cmd="sudo ssm -c $conf --sync --summary"
run_cmd

# rm -fr $test_dir

